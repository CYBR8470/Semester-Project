<html>
    <head>
        <title>Game Page</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'style.css' %}">
        <meta http-equiv = "refresh" content="30; url = {% url 'board' game.game_id %}" />
        <style>
            .window{
                height: 90vh;
                width: 98vw;
                display: grid;
                grid-auto-rows: 9vh;
                grid-auto-columns: 9.8vw;
            }
            .gamebox{
                grid-column: 1 / 9;
                grid-row: 1 / 9;
                border: 3px solid black;
            }
            .scorebox{
                grid-column: 9 / 11;
                grid-row: 1 / 9;
                border: 3px solid black;
            }
            .playerbox{
                grid-column: 1 / 11;
                grid-row: 9 / 11;
                border: 3px solid black;
            }
            .die {
              height: 9vh;
              width: 9vh;
              border: 1px solid black;
              text-align: center;
              line-height: 9vh;
              font-size: 9vh;
              display: inline-block;
            }
            .die-selected {
                border: 3px solid green;
            }
            .score {
              height: 3vh;
              width: auto;
              text-align: center;
              line-height: 3vh;
              font-size: 3vh;
              display: inline-block;
            }
        </style>
    </head>
    <body>        
        <div class="window">
            <div class="gamebox">
                <h1>Game Id: {{ game.game_id }}</h1>
                <h1>Host: {{ game.host }}</h1>
                <h1>Join Code: {{ game.join_code }}</h1>
                <h1>Is Public: {{ game.is_public }}</h1>
                <h1>Is Open: {{ game.is_open }}</h1>
                <div id="d1" class="die">{{hand.d1}}</div>
                <div id="d2" class="die">{{hand.d2}}</div>
                <div id="d3" class="die">{{hand.d3}}</div>
                <div id="d4" class="die">{{hand.d4}}</div>
                <div id="d5" class="die">{{hand.d5}}</div>
                <p id="rollCount">Roll Count: {{hand.roll_count}}</p>
                <button><a href="{% url 'board' game.game_id %}">Refresh Screen</a></button>
                <button id="rollDice">Roll the dice!</button>
            </div>
            <div class="scorebox">
                <div class="score">Player:{{score.player}}</div><br>
                <div class="score">Ones:</div>
                  {% if score.ones == null %}
                    <button>
                      <a class="score" href="{% url 'action' game.game_id 'setOnes' %}">
                        {{hand.sumOnes}}
                      </a>
                    </button>
                  {% else %}
                    <div class="score">
                      {{score.ones}}
                    </div>
                  {% endif %}
                <br>
                <div class="score">Twos:</div>
                  {% if score.twos == null %}
                    <button>
                      <a class="score" href="{% url 'action' game.game_id 'setTwos' %}">
                        {{hand.sumTwos}}
                      </a>
                    </button>
                  {% else %}
                    <div class="score">
                      {{score.twos}}
                    </div>
                  {% endif %}
                <br>
                <div class="score">Threes:</div>
                  {% if score.threes == null %}
                    <button>
                      <a class="score" href="{% url 'action' game.game_id 'setThrees' %}">
                        {{hand.sumThrees}}
                      </a>
                    </button>
                  {% else %}
                    <div class="score">
                      {{score.threes}}
                    </div>
                  {% endif %}
                <br>
                <p>Fours:
                  {% if score.fours == null %}
                    <button>
                      <a class="score" href="{% url 'action' game.game_id 'setFours' %}">
                        {{hand.sumFours}}
                      </a>
                    </button>
                  {% else %}
                    <div class="score">
                      {{score.fours}}
                    </div>
                  {% endif %}
                </p>
                <p>Fives:<button>{{hand.sumFives}}</button></p>
                <p>Sixes:<button>{{hand.sumSixes}}</button></p>
                <p>Three Of A Kind:<button>{{hand.threeOAK}}</button></p>
                <p>Four Of A Kind:<button>{{hand.fourOAK}}</button></p>
                <p>Full House:<button>{{hand.fullHouse}}</button></p>
                <p>Small Straight:<button>{{hand.smallStraight}}</button></p>
                <p>Large Straight:<button>{{hand.largeStraight}}</button></p>
                <p>Yahtzee:<button>{{hand.yahtzee}}</button></p>
                <p>Chance:<button>{{hand.chance}}</button></p>
                {{score.sumValues}}
            </div>
            <div class="playerbox">
                <a href="{% url 'end' %}">End Game |</a>
                <a href="/">Home</a>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/JavaScript">

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        

        function setDiceRoll() {
            debugger;
            var selectedDice = $('.die-selected');
            var array = [0,0,0,0,0]
            if(selectedDice.length > 0)
            {
                $.each(selectedDice, function(index, value){
                    var id = value.id;
                    var diceValue = $('#'+id)[0].innerText;
                    var idNumber = id.split('d')[1];
                    array[idNumber-1] = parseInt(diceValue);
                });
            }
            var player = $('#playerId').val();
            var game = $('#gameId').val();
            var csrftoken = getCookie('csrftoken');
            data = {
                'd1': array[0],
                'd2': array[1],
                'd3': array[2],
                'd4': array[3],
                'd5': array[4],
                'player': player,
                'game': game
            };

            $.ajax({
                method: 'POST',
                url: '../api/rolldice',
                data: data,
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function(data, status){
                    var allDice = $('.die');
                    $.each(allDice, function(index, value){
                    var singleDice = $('#'+value.id)[0]
                    singleDice.innerText = data['d'+(index +1)];
                    $('#rollCount')[0].innerText = "Roll Count: " + data['roll_count'];
                });
                }
            });
        }

        $('.die').click(function(evt){
            var dice = evt.currentTarget;
            $('#'+dice.id).toggleClass('die-selected');
        });
        $('#rollDice').click(function(){ setDiceRoll() });
        </script>
    </body>
</html>
